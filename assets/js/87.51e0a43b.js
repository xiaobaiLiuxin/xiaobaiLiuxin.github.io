(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{637:function(t,a,v){"use strict";v.r(a);var s=v(17),_=Object(s.a)({},(function(){var t=this,a=t.$createElement,v=t._self._c||a;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"wath"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#wath"}},[t._v("#")]),t._v(" WATH")]),t._v(" "),v("p",[t._v("就是我们所说的主从复制，主机数据更新后根据配置和策略，自动同步到备机的 master/slaver 机制，master 以写为主，slave 以读为主。")]),t._v(" "),v("h3",{attrs:{id:"官网介绍"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#官网介绍"}},[t._v("#")]),t._v(" 官网介绍")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127102513.png",alt:"image-20211127102513436"}})]),t._v(" "),v("h2",{attrs:{id:"can"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#can"}},[t._v("#")]),t._v(" CAN")]),t._v(" "),v("ul",[v("li",[t._v("读写分离")]),t._v(" "),v("li",[t._v("容灾恢复")])]),t._v(" "),v("h2",{attrs:{id:"how"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#how"}},[t._v("#")]),t._v(" HOW")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("配从不配主")])]),t._v(" "),v("li",[v("p",[t._v("从库配置")])]),t._v(" "),v("li",[v("p",[t._v("修改配置文件细节操作")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("拷贝多个redis.conf 文件")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127161554.png",alt:"image-20211127161554186"}})])]),t._v(" "),v("li",[v("p",[t._v("开启 daemonize yes")])]),t._v(" "),v("li",[v("p",[t._v("配置对应 Pid 文件名")])]),t._v(" "),v("li",[v("p",[t._v("指定端口")])]),t._v(" "),v("li",[v("p",[t._v("修改 Log 文件名")])]),t._v(" "),v("li",[v("p",[t._v("修改 Dump.rdb 文件名")])])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127161826.png",alt:"image-20211127161825984"}})])]),t._v(" "),v("li",[v("p",[t._v("常用 3 招")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("一主二仆")]),t._v(" "),v("p",[t._v("一个 master 两个 slave")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127162900.png",alt:"image-20211127162859986"}})]),t._v(" "),v("blockquote",[v("p",[t._v("1.切入问题：slave1、slave2 是从头开始复制还是从切入点开始复制？比如从 k4 进入，那之前 k1、k2、k3 是否也可以复制？")]),t._v(" "),v("p",[t._v("答：从头开始复制，可以复制。")]),t._v(" "),v("p",[t._v("2.从机是否可以写？set 可否？")]),t._v(" "),v("p",[t._v("答：不可")]),t._v(" "),v("p",[t._v("3.主机 shutodown 后情况如何？从机是上位还是原地待命？")]),t._v(" "),v("p",[t._v("答：主机挂机后 从机原地待命。")]),t._v(" "),v("p",[t._v("4.主机又回来后，主机新增记录，从机是否能够顺利复制？")]),t._v(" "),v("p",[t._v("答：主机回来后还是 master，从机依然能够顺利复制。")]),t._v(" "),v("p",[t._v("5.其中一台从机 down 后情况如何？依照原有它能跟上大部队吗？")]),t._v(" "),v("p",[t._v("答：从机 down 后需重新配置才能连上主机。")])])])]),t._v(" "),v("p",[t._v("​")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("薪火相传")]),t._v(" "),v("p",[t._v("上一个 slave 可以是下一个 slave 的 master，slave 同样可以接受其他 slaves 的连接和同步请求，那么该 slave 作为了链条中下一个的 master 可以有效减轻 master 的压力。")]),t._v(" "),v("p",[t._v("中途变更转向会清除之前的数据，重新建立拷贝最新的 slaveof 新主库 IP 新主库端口。")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127165348.png",alt:"image-20211127165347676"}})])]),t._v(" "),v("li",[v("p",[t._v("反客为主")]),t._v(" "),v("p",[v("code",[t._v("SLAVEOF no one")]),t._v("  使当前数据库停止与其他数据库的同步，转为主数据库。")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",[v("code",[t._v("   \t\t![image-20211127170857987](http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127170858.png)\n")])])])])])])]),t._v(" "),v("h2",{attrs:{id:"复制原理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#复制原理"}},[t._v("#")]),t._v(" 复制原理")]),t._v(" "),v("p",[t._v("slave 启动成功连接到 master 后会发送一个 sync 命令，master 接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕后，master 将传送整个数据文件到 salve，以完成一次完全同步。")]),t._v(" "),v("ul",[v("li",[t._v("全量复制：slave 服务在接收到数据库文件数据后，在其存盘并加载到内存中。")]),t._v(" "),v("li",[t._v("增量复制：master 继续将新的所有收集到的修改命令依次传给 slave，完成同步。但只要是重新连接 master，一次完全同步（全量复制）将被自动执行。")])]),t._v(" "),v("h2",{attrs:{id:"哨兵模式"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#哨兵模式"}},[t._v("#")]),t._v(" 哨兵模式")]),t._v(" "),v("h3",{attrs:{id:"what"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#what"}},[t._v("#")]),t._v(" WHAT")]),t._v(" "),v("p",[t._v("反客为主的自动版，能够后台监控主库是否出现故障，如果主库出现故障则根据投票数自动将从库转换为主库。")]),t._v(" "),v("p",[t._v("一组 sentinel 能同时监控多个 master。")]),t._v(" "),v("h3",{attrs:{id:"how-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#how-2"}},[t._v("#")]),t._v(" HOW")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("调整结构")]),t._v(" "),v("p",[t._v("主机 6379 带从机 80、81")])]),t._v(" "),v("li",[v("p",[t._v("自定义的 /opt/redis-6.2.6-bak 目录下新建 sentinel.conf 文件，名字绝不能错")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127172514.png",alt:"image-20211127172513930"}})])]),t._v(" "),v("li",[v("p",[t._v("配置哨兵")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127172307.png",alt:"image-20211127172307549"}})])]),t._v(" "),v("li",[v("p",[t._v("正常主从演示")])]),t._v(" "),v("li",[v("p",[t._v("原有的master 规律")])]),t._v(" "),v("li",[v("p",[t._v("投票新选")])]),t._v(" "),v("li",[v("p",[t._v("重新主从继续开工，info replication 查查看")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127175532.png",alt:"image-20211127175531939"}})])]),t._v(" "),v("li",[v("p",[t._v("问题：如果之前的 master 重启回来，会不会双 master 冲突")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://rdgmm6gnu.hn-bkt.clouddn.com/images/20211127180204.png",alt:"image-20211127180203444"}})])])]),t._v(" "),v("h2",{attrs:{id:"复制的缺点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#复制的缺点"}},[t._v("#")]),t._v(" 复制的缺点")]),t._v(" "),v("p",[t._v("复制延迟，由于所有的写操作都是先在 master 上操作，然后同步更新到 slave 上，所以从 master 同步到 slave 机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，slave 机器数量的增加会使这个问题更加严重。")])])}),[],!1,null,null,null);a.default=_.exports}}]);